---
description: 
globs: main/database/**/*.ts,renderer/src/database/**/*.ts,renderer/src/types/database/**/*.ts
alwaysApply: false
---
 # データベース関連のルール

## 適用範囲
- `main/database/**/*.ts`
- `renderer/src/database/**/*.ts`
- `renderer/src/types/database/**/*.ts`

## ルール内容

### データベース接続管理
- GCP Cloud SQLへの接続にはサービスアカウント認証を実装
- 接続プールを使用した効率的な接続管理
- 接続エラーの適切な処理とリトライロジック
- 認証情報は環境変数またはセキュアな設定ファイルから取得
- 長時間実行クエリのタイムアウト処理
- 複数データベース接続構成の保存・管理機能
- 接続情報の安全な保存方法の実装
- 複数データベース対応のドライバ管理システム

### SQLクエリ最適化
- 読みやすいSQLクエリのフォーマット
- 複雑なクエリへの説明コメント追加
- データベース固有機能の活用
  - PostgreSQL: JSON操作、ウィンドウ関数、配列、継承テーブル
- インデックスと効率的なJOINの使用
- プリペアドステートメントの適切な使用
- SQLインジェクション対策
- 大量データ取得時のカーソルベースアプローチ
- クエリ生成部分の抽象化

### エラー処理
- すべてのSQL操作でのエラー処理
- ユーザーフレンドリーなエラーメッセージ
- デバッグ用の詳細なエラーログ
- 接続エラー、クエリエラー、タイムアウトの適切な処理
- GCP Cloud SQL接続問題のトラブルシューティング情報
- データベース固有のエラーコード処理